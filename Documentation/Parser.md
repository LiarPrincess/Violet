# Parser

Parser is responsible for transforming a stream of tokens to `AST`.

- standard [recursive descent parser](https://en.wikipedia.org/wiki/Recursive_descent_parser) (+minor hacks for ambiguous grammar).
- we use the same [Grammar file](https://github.com/python/cpython/blob/3.6/Grammar/Grammar) as CPython 3.6
- `AST` type definitions are generated by [Elsa](https://github.com/LiarPrincess/Violet/Sources/Elsa) from [Definitions/ast.letitgo](https://github.com/LiarPrincess/Violet/Definitions/ast.letitgo)
- `AST` implements pretty printer interface from [Rapunzel](https://github.com/LiarPrincess/Violet/Sources/Rapunzel)
- each function that implements specific grammar rule has this rule in doc-comment
- it will use standard lexer for [fstring](https://www.python.org/dev/peps/pep-0498/) expressions (we get fstring as `formatString(String)` token and we need to break this string into strings and literals)

Please note that CPython plans to switch to [PEG parser](https://en.wikipedia.org/wiki/Parsing_expression_grammar) (see [PEP-0617](https://www.python.org/dev/peps/pep-0617/)), but this endeavour is not yet finished thus we can't use it.

## Important files

- `Parser` - main type (duh…). Please note that this is is more of a “lexical closure” for properties than a proper object-oriented entity.
- `Generated` directory - files generated by [Elsa](https://github.com/LiarPrincess/Violet/Sources/Elsa)
  - `AST.swift` - `AST` node type definitions
  - `ASTBuilder.swift` - helper for creating nodes (mainly assigning increasing `id`)
  - `ASTVisitors.swift` - visitor interfaces

- `ASTValidator.swift` - check if the given `AST` is valid
- `LexerAdapter.swift` - minor pre-processing of original token stream. It is responsible for: merging multiple `.newLine` tokens, skipping `.comment` tokens etc.
- `Parser+UNIMPLEMENTED.swift` - things that are not yet implemented

## Other docs

- [Language reference](https://docs.python.org/3/reference/index.html)
- [greentreesnakes/Meet the Nodes](https://greentreesnakes.readthedocs.io/en/latest/nodes.html) - missing CPython `AST` documentation. Since we use very similar `AST` definition, most of it is applicable to us.
- CPython
  - [Grammar](https://github.com/python/cpython/blob/3.6/Grammar/Grammar)
  - [Python/ast.c](https://github.com/python/cpython/blob/3.6/Python/ast.c)
